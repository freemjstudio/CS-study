# 페이지 교체 알고리즘

> 페이지 부재 발생 → 새로운 페이지를 할당해야 함 → 현재 할당된 페이지 중 어떤 것 교체할 지 결정하는 방법
> 

## 배경 설명

가상 메모리는 `요구 페이지 기법`을 통해 필요한 페이지만 메모리에 적재하고 사용하지 않는 부분은 그대로 둔다. 하지만 필요한 페이지만 올려도 메모리는 결국 가득 차게 되고(=Page-falut가 발생하였다.), 올라와있던 페이지가 사용이 다 된 후에도 자리만 차지하고 있을 수 있다.

따라서 메모리가 가득 차면, 추가로 페이지를 가져오기 위해서 안쓰는 페이지는 OUT하고, 해당 공간에 현재 필요한 페이지를 IN 시켜야 한다.

여기서 어떤 페이지를 OUT 시켜야할 지 정해야 한다. (이때, OUT 되는 페이지 = **victim page**)

기왕이면 수정이 되지 않는 페이지를 선택해야 좋다. (Why? : 만약 수정되면 메인 메모리에서 내보낼 때, 하드디스크에서 또 수정을 진행해야 하므로 시간이 오래 걸린다.)

<aside>
💡 페이지 교체 알고리즘은 page-fault 발생 비율을 줄이는 것을 목표로 한다.

</aside>

## 교체 방식

- Global 교체
    
    > 메모리 상의 모든 프로세스 페이지에 대해 교체하는 방식
    > 
- Local 교체
    
    > 메모리 상의 자기 프로세스 페이지에서만 교체하는 방식
    > 

다중 프로그래밍의 경우, 메인 메모리에 다양한 프로세스가 동시에 올라올 수 있다. 따라서, 다양한 프로세스의 페이지가 메모리에 존재함

페이지 교체 시, 다양한 페이지 교체 알고리즘을 활용해 victim page를 선정하는데, 선정 기준을 Global로 하느냐, Local로 하느냐가 차이다.

→ 실제로는 전체를 기준으로 페이지를 교체하는 것이 더 효율적이다. 자기 프로세스 페이지에서만 교체를 하면, 교체를 해야할 때 각각 모두 교체를 진행해야 하므로 비효율적이다.

- 간단한 알고리즘 : 무작위, FIFO
- 이론적알고리즘 : 최적
- 최적 근접 알고리즘 : LRU, LFU, NUR, FIFO 변형

![전체](https://velog.velcdn.com/images/chappi/post/0c6d701f-fe74-4f9b-9e1f-157a0ac266f0/1.png)

## 페이지 교체 알고리즘

### 1. 무작위 페이지 알고리즘

특별한 로직 없이 무작위로 선정

### 2. FIFO 알고리즘

<aside>
💡 First-in First-out, 메모리에 먼저 올라온 페이지를 먼저 내보내는 알고리즘

</aside>

장 : 가장 간단한 방법으로, 특히 초기화 코드에서 적절한 방법이다.

단: 무조건 오래된 페이지를 대상페이지로 선정하기 때문에 성능이 떨어진다. → 2차 기회 페이지 알고리즘으로 개선

`초기화 코드` : 처음 프로세스 실행될 때 최초 초기화를 시키는 역할만 진행하고 다른 역할은 수행하지 않으므로, 메인 메모리에서 빼도 괜찮다. 하지만 처음 프로세스 실행시에는 무조건 필요한 코드이므로, FIFO 알고리즘을 사용하면 초기화를 시켜준 후 가장 먼저 내보내는 것이 가능하다.

![FIFO](https://velog.velcdn.com/images/chappi/post/7734ec14-98da-4784-8e26-163514b8021e/2.png)

세 번만 성공했다. 즉 페이지 부재(page fault)가 7번 발생했다.

### 3. **최적 페이지 교체 알고리즘(**OPT 알고리즘)

<aside>
💡 Optimal Page Replacement, 앞으로 가장 사용하지 않을 페이지를 가장 우선적으로 내보내는 알고리즘

</aside>

장 : FIFO에 비해 페이지 결함의 횟수를 많이 감소시킬 수 있다.

단 : 실질적으로 페이지가 앞으로 잘 사용되지 않을 것이라는 보장이 없기 때문에 수행하기 어려운 알고리즘이다.

실제로는 구현이 거의 불가능하고 연구목적으로만 사용된다.

![OPt](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/43c83bda-3219-43aa-8e4c-d76985b50f76/Untitled.png)

### 4. LRU 알고리즘

<aside>
💡 Least-Recently-Used, 최근에 사용하지 않은 페이지를 가장 먼저 내려보내는 알고리즘

</aside>

최근에 사용하지 않았으면, 나중에도 사용되지 않을 것이라는 아이디어에서 나왔다.

OPT의 경우 미래 예측이지만, LRU의 경우는 과거를 보고 판단하므로 실질적으로 사용이 가능한 알고리즘이다.

(실제로도 최근에 사용하지 않은 페이지는 앞으로도 사용하지 않을 확률이 높다)

장점 : OPT보다는 페이지 결함이 더 일어날 수 있지만, **실제로 사용할 수 있는 페이지 교체 알고리즘에서는 가장 좋은 방법 중 하나이다.**

![LRU](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4c1a70f0-9d20-410a-9295-6d2a7b74e7d9/Untitled.png)

### 5. LFU 알고리즘

<aside>
💡 Least-Frequently-Used; 과거에 참조 횟수가 가장 낮은 페이지를 교체하는 알고리즘

</aside>

페이지의 참조 횟수로 교체할 페이지를 결정하는 알고리즘이다. LFU 알고리즘은 크게 2가지로 나뉘어진다.

- Incache-LFU: 메모리에 적재될 때부터 페이지의 횟수를 카운트 하는 방식
- Perfect-LFU: 메모리 적재 여부와 상관없이 페이지의 과거 총 참조 횟수를 카운트 하는 방식
`Perfect-LFU의 경우 정확하게 참조 횟수를 파악할 수 있지만 시간에 따른 참조의 변화를 반영하지 못하고, 구현이 복잡하다는 단점이 있다.`

LRU는 직전 참조된 시점만을 반영하지만, LFU는 참조 횟수를 통해 장기적 시간 규모에서의 참조 성향을 고려할 수 있다. 하지만, 가장 최근에 불러온 페이지가 교체될 수도 있으며, 구현이 복잡하고 막대한 오버헤드가 있다는 단점이 있다.

![LFU](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0d67ffc0-20ef-4a21-8a12-8ac72b77fbb0/Untitled.png)

### 6. MFU 알고리즘

<aside>
💡 Most-Frequently-Used; 가장 많은 페이지를 교체하는 알고리즘이다.

</aside>

![MFU](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c0a7bcbf-8f59-402d-b63f-e15fcfc068a2/Untitled.png)

### 7**. NUR = NRU 알고리즘**

<aside>
💡 Not Used Recently, Not Recently Used; 클럭 알고리즘으로 하드웨어적인 자원을 통해 기존 LRU, LFU 알고리즘의 소프트웨어적인 운영 오버헤드를 줄인 방식

</aside>

클럭 알고리즘은 LRU처럼 가장 오랫동안 사용되지 않은 페이지를 대상으로 선정한다는 점에서 LRU와 근사하지만, 교체되는 페이지의 참조 시점이 가장 오래되었다는 것을 보장하지는 않는다.

클럭 알고리즘은 아래의 그림처럼 참조 비트(reference bit)를 순차적으로 조사하며 동작한다.

1. 프레임 내의 페이지가 참조될 때 하드웨어에 의해 1로 자동으로 세팅된다.
2. 클럭 알고리즘은 한 바퀴 돌며 참조되지 않은 페이지의 참조 비트 값을 0으로 바꾼 후 지나간다.
3. 참조 비트가 0인 페이지를 방문하면 해당 페이지를 교체한다.

![NUR](https://velog.velcdn.com/images/subinmun1997/post/22d3b491-987d-40bc-8188-b1df1fd78412/image.png)

즉, 페이지가 참조되어 1이 되고, 한 바퀴 도는 동안 사용되지 않으면 0이 되고 다시 한 바퀴를 도는 동안 사용되지 않는 페이지는 참조되지 않았으므로 교체 대상 페이지로 선정하는 알고리즘이다.

클럭 알고리즘은 시계 바늘이 한 바퀴 도는 동안 걸리는 시간만큼 페이지를 메모리에 유지시켜 페이지 부재율을 줄이도록 설계 되었다. 때문에 클럭 알고리즘을 **2차 기회 알고리즘**이라 부르기도 한다.

https://velog.io/@chappi/OS%EB%8A%94-%ED%95%A0%EA%BB%80%EB%8D%B0-%ED%95%B5%EC%8B%AC%EB%A7%8C-%ED%95%A9%EB%8B%88%EB%8B%A4.-17%ED%8E%B8-%ED%8E%98%EC%9D%B4%EC%A7%80-%EA%B5%90%EC%B2%B4-%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98FIFO-LRU-LFU-NUR-2%EC%B0%A8-%EA%B8%B0%ED%9A%8C-%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98-%EC%8B%9C%EA%B3%84-%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98
